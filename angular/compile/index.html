<!DOCTYPE html>
<html>
<head>
  <title>angular compile</title>
  <style type="text/css">
  .cbox {
    border: solid 1px #ccc; margin: 20px; padding: 0 20px 20px;
    overflow: hidden; background-color: #f2f2f2;
  }
  pre {
    border: dashed 1px #aaa;
  }
  </style>
  <link type="text/css" rel="stylesheet" href="../../lib/prism/prism.css"  media="screen,projection"/>
</head>
<body>
<h1>Angular Compile</h1>

<div class="cbox">
  <h3>injectionArgs</h3>
  <pre class="language-javascript" data-language="JavaScript">
<code>function injectionArgs(fn, locals, serviceName) {
  var args = [],
      $inject = createInjector.$$annotate(fn, strictDi, serviceName);

  for (var i = 0, length = $inject.length; i < length; i++) {
    var key = $inject[i];
    if (typeof key !== 'string') {
      throw $injectorMinErr('itkn',
              'Incorrect injection token! Expected service name as string, got {0}', key);
    }
    args.push(locals && locals.hasOwnProperty(key) ? locals[key] :
                                                     getService(key, serviceName));
  }
  return args;
}</code></pre>
  <div id="injectionArgs"></div>
</div>

<div class="cbox">
  <h3>instantiate</h3>
  <pre class="language-javascript" data-language="JavaScript">
<code>function instantiate(Type, locals, serviceName) {
  // Check if Type is annotated and use just the given function at n-1 as parameter
  // e.g. someModule.factory('greeter', ['$window', function(renamed$window) {}]);
  var ctor = (isArray(Type) ? Type[Type.length - 1] : Type);
  var args = injectionArgs(Type, locals, serviceName);
  // Empty object at position 0 is ignored for invocation with `new`, but required.
  args.unshift(null);
  /*jshint -W058 */ // Applying a constructor without immediate parentheses is the point here.
  return new (Function.prototype.bind.apply(ctor, args));
  /*jshint +W058 */
}</code></pre>
  <div id="instantiate"></div>
</div>


<div id="chartCodes" style="display:none;">

<textarea id="diCode">
instanceInjector->instanceCache: find in instance cache
instanceCache->instanceInjector: cache not match
instanceInjector->providerInjector: go to provider
providerInjector->providerCache: find in provider cache
providerCache->providerInjector: cache match
providerInjector->instanceInjector: invoke(provider.$get)
instanceInjector->instanceCache: put into instanceCache
</textarea>

<textarea id="loadCode">
st=>start: Start
e=>end: End
loopM=>condition: loop modules
(forEach)
req=>operation: loadModules(module.requiers)
load require modules and return run blocks
concat1=>operation: cancat require modules' run blocks
concat2=>operation: concat run blocks
invoke=>operation: invoke queue
config=>operation: config blocks

retrun=>operation: return run blocks
invokerun=>operation: invoke run blocks

st->loopM(yes)->req->concat1->concat2->invoke->config->retrun
loopM(no)->retrun->e

</textarea>


</div>


<script src="../../lib/raphael-min.js"></script>
<script src="../../lib/underscore-min.js"></script>
<script src="../../lib/sequence-diagram-min.js"></script>
<script src="../../lib/flowchart-latest.js"></script>

<script type="text/javascript" src="../../lib/prism/prism.js"></script>

<script type="text/javascript" src="../../app/app.js"></script>

<script type="text/javascript">
// genDiagram('di');
// genChart('load');
// genChart('injectionArgs');
// genChart('instantiate');
// genChart('invoke');
// genChart('getService');
// genChart('provider');
// genChart('factory');
// genChart('service');
</script>

</body>
</html>